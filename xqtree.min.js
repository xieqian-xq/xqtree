/*!
 * xqtree v1.0.0 ()
 * Copyright 2021 xieqian.
 * Licensed under the  license
 */
"use strict";function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.xqTree=t()}(window,function(){var o={onClick:function(){},onCheck:function(){}},p={_id:"",open:!1,checked:!1,checkedPart:!1};function u(e,t,n){if(e!==Object(e))throw new Error("xqTree需要一个元素容器");this.element=e,this.originalNodes=n,this.config=_objectSpread(_objectSpread({},o),t),this.nodes={},u.type.isArray(n)&&0<n.length&&this.setNodes(n)}function f(e,d,a){var h=this;d=d||0,a=a||"tree_0_0_0";var l=y.ul(d);return e.forEach(function(e){e=Object.assign({},p,e);var t=function(e,t,n){return function(e,t,n){n=n.split("_")[3];var o="tree_"+t+"_"+n+"_";""===e._id&&(n=Object.keys(this.nodes).filter(function(e){return-1<e.indexOf(o)}),e._id=o+(n.length+1));return this.nodes[e._id]=e}.call(this,e,t,n)._id}.call(h,e,d,a),n=y.li(d,e),o=y.spanCheckbox(),r=y.aLink(),c=y.spanIcon(),i=y.spanText(e.name),s=y.spanSwitch();n.append(o),n.append(r),r.append(c,i),u.type.isArray(e.children)&&0<e.children.length&&((t=f.call(h,e.children,d+1,t)).style.height=e.open?"auto":"0",n.append(s),n.append(t)),l.append(n)}),l}u.forEach=function(e,t){Array.prototype.forEach.call(e,t)},u.type=function(e){return Object.prototype.toString.call(e).match(/\[object (.*?)\]/)[1].toLowerCase()},["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp"].forEach(function(t){u.type["is"+t]=function(e){return u.type(e)===t.toLowerCase()}}),u.prototype.setNodes=function(e){e=f.call(this,e);this.element.append(e),function(){var o=this;function t(e){var t=this.parentNode,n=o.getNodeObj(t);n.checked&&!n.checkedPart?o.setNodeNoChecked(t):o.setNodeChecked(t),o.config.onCheck(e,n)}function n(e){var t=this.parentNode,n=o.getNodeObj(t);n.open?o.setNodeClose(t):o.setNodeOpen(t),o.config.onClick(e,n)}Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-checkbox"),function(e){e.addEventListener("click",t,!1)}),Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-link"),function(e){e.addEventListener("click",n,!1)})}.call(this)},u.prototype.setNodeOpen=function(e){var t,n=e.lastChild;"UL"===n.nodeName&&((t=n.previousSibling).previousSibling.classList.add("xqtree-node-link-open"),t.classList.remove("xqtree-node-switch-close"),t.classList.add("xqtree-node-switch-open"),this.nodes[e.id].open=!0,t=this.getNodeOpenHeight(e),n.style.height=t+"px",this.setNodeParentOpen(e,t))},u.prototype.setNodeParentOpen=function(e,t){var n=e.parentNode;"false"===n.getAttribute("root")&&(e=n.clientHeight+t,n.style.height=e+"px",this.setNodeParentOpen(n.parentNode,t))},u.prototype.setNodeClose=function(e){var t,n=e.lastChild;"UL"===n.nodeName&&((t=n.previousSibling).previousSibling.classList.remove("xqtree-node-link-open"),t.classList.remove("xqtree-node-switch-open"),t.classList.add("xqtree-node-switch-close"),this.nodes[e.id].open=!1,t=n.clientHeight,n.style.height="0px",this.setNodeParentClose(e,t))},u.prototype.setNodeParentClose=function(e,t){var n=e.parentNode;"false"===n.getAttribute("root")&&(e=n.clientHeight-t,n.style.height=e+"px",this.setNodeParentClose(n.parentNode,t))},u.prototype.getNodeOpenHeight=function(e){var t=e.lastChild,n=0;return"UL"===t.nodeName&&this.nodes[e.id].open&&u.forEach(t.children,function(e){n+=e.clientHeight}),n},u.prototype.setNodeChecked=function(e){this.setNodeCheckedStatus(e,!0,!1),"UL"===e.lastChild.nodeName&&this.setNodeChildChecked(e),"UL"===e.parentNode.nodeName&&"false"===e.parentNode.getAttribute("root")&&this.setNodeParentCheckedStatus(e)},u.prototype.setNodeChildChecked=function(e){var t=this,e=e.lastChild;"UL"===e.nodeName&&u.forEach(e.children,function(e){t.setNodeCheckedStatus(e,!0,!1),t.setNodeChildChecked(e)})},u.prototype.setNodeParentCheckedStatus=function(e){var t=e.parentNode;"UL"===t.nodeName&&"false"===t.getAttribute("root")&&(e=t.parentNode,t=this.getNodeCheckedStatus(e),this.setNodeCheckedStatus(e,t.checked,t.checkedPart),this.setNodeParentCheckedStatus(e))},u.prototype.setNodeNoChecked=function(e){this.setNodeCheckedStatus(e,!1,!1),"UL"===e.lastChild.nodeName&&this.setNodeChildNoChecked(e),"UL"===e.parentNode.nodeName&&"false"===e.parentNode.getAttribute("root")&&this.setNodeParentCheckedStatus(e)},u.prototype.setNodeChildNoChecked=function(e){var t=this,e=e.lastChild;"UL"===e.nodeName&&u.forEach(e.children,function(e){t.setNodeCheckedStatus(e,!1,!1),t.setNodeChildNoChecked(e)})},u.prototype.setNodeCheckedStatus=function(e,t,n){var o=e.firstChild;o.classList.remove("xqtree-node-checkbox-select-false"),o.classList.remove("xqtree-node-checkbox-select-part"),o.classList.remove("xqtree-node-checkbox-select-true"),t&&!n?(o.classList.add("xqtree-node-checkbox-select-true"),this.nodes[e.id].checked=!0,this.nodes[e.id].checkedPart=!1):t&&n?(o.classList.add("xqtree-node-checkbox-select-part"),this.nodes[e.id].checked=!0,this.nodes[e.id].checkedPart=!0):(o.classList.add("xqtree-node-checkbox-select-false"),this.nodes[e.id].checked=!1,this.nodes[e.id].checkedPart=!1)},u.prototype.getNodeCheckedStatus=function(e){var t,n,o=this,r=e.lastChild,e={checked:!0,checkedPart:!1};return"UL"===r.nodeName&&(n=t=0,u.forEach(r.children,function(e){e=o.getNodeObj(e);e.checked&&(t++,e.checkedPart&&n++)}),0===t?(e.checked=!1,e.checkedPart=!1):t===r.childElementCount&&0===n?(e.checked=!0,e.checkedPart=!1):(e.checked=!0,e.checkedPart=!0)),e},u.prototype.getNodeObj=function(e){return this.nodes[e.id]};var y={ul:function(e){var t=document.createElement("ul");return 0===e&&t.classList.add("xqtree"),t.setAttribute("root",0===e),t},li:function(e,t){var n=document.createElement("li");return n.id=t._id,n.classList.add("xqtree-node"),n.setAttribute("level",e),n},spanCheckbox:function(){return this.span("xqtree-node-checkbox","xqtree-node-checkbox-select-false")},aLink:function(){var e=document.createElement("a");return e.classList.add("xqtree-node-link"),e.href="javascript:void(0)",e},spanIcon:function(){return this.span("xqtree-node-link-icon")},spanText:function(e){var t=this.span("xqtree-node-link-text");return t.innerText=e,t},spanSwitch:function(){return this.span("xqtree-node-switch","xqtree-node-switch-close")},span:function(){var e,t=document.createElement("span");return(e=t.classList).add.apply(e,arguments),t}};return u});